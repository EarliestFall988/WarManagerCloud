// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model Post {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  content String @db.VarChar(255)

  authorId String

  @@index([authorId])
}

model Project {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  jobNumber   String @db.VarChar(255)
  name        String @db.VarChar(255)
  description String @db.VarChar(255)
  notes       String @db.Text

  address String @db.VarChar(255)
  city    String @db.VarChar(255)
  state   String @db.VarChar(255)
  zip     String @db.VarChar(255)

  startDate       DateTime
  endDate         DateTime
  status          String   @db.VarChar(255)
  percentComplete Float    @default(0)
  completed       Boolean  @default(false)

  TotalManHours Int   @default(0)
  JobDetails    Json? @default("{}") @db.Json

  laborCost         Float @default(0)
  subContractorCost Float @default(0)
  materialCost      Float @default(0)
  equipmentCost     Float @default(0)
  otherCost         Float @default(0)

  safetyRating        String @db.VarChar(255)
  qualityRating       String @db.VarChar(255)
  staffingRating      String @db.VarChar(255)
  profitabilityRating String @db.VarChar(255)
  customerRating      String @db.VarChar(255)

  BillDate DateTime

  scopeOfWork ScopeOfWork[]

  managers CrewMember[]
  sectors  Sector[]

  authorId String
  tags     Tag[]

  @@index([authorId])
}

model ScopeOfWork {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String @db.VarChar(255)
  description String @db.VarChar(255)

  scope     String         @db.Text
  materials MaterialType[]

  authorId  String
  Project   Project? @relation(fields: [projectId], references: [id])
  projectId String?

  @@index([authorId])
  @@index([projectId])
}

model CrewMember {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String  @db.VarChar(255)
  position    String  @db.VarChar(255)
  description String  @db.VarChar(255)
  phone       String  @db.VarChar(255)
  email       String  @db.VarChar(255)
  travel      String  @db.VarChar(255)
  skills      Json?
  rating      String  @db.VarChar(255)
  sector      Sector? @relation(fields: [sectorId], references: [id])

  lastReviewDate DateTime?

  tags Tag[]

  wage   Float
  burden Float
  rate   Float
  hours  Float
  total  Float

  authorId String
  sectorId String?

  Project   Project[]
  projectId String?

  @@index([authorId])
  @@index([sectorId])
}

model Blueprint {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String   @db.VarChar(255)
  description String   @db.VarChar(255)
  pinned      Boolean? @default(false)

  data String @db.Text

  sector      Sector[]
  permissions Permissions[]
  tags        Tag[]

  notes Note[]

  authorId String

  @@index([authorId])
}

model Equipment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String  @db.VarChar(255) // this is the name of the equipment, like "Manitex 40100 Crane"
  type        String  @db.VarChar(255) // this is the type of equipment, like a crane, or a forklift
  EquipmentId String  @db.VarChar(255) // this is some JR&Co's internal ID
  description String? @db.VarChar(255) // this is a description of the equipment if desired

  data Json? @db.Json // other data

  authorId String

  @@index([authorId])
}

model Sector {
  id        String   @id @unique @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name           String @unique @db.VarChar(255)
  departmentCode String @unique @db.VarChar(255)
  description    String @db.VarChar(255)

  CrewMembers CrewMember[]
  Blueprints  Blueprint[]
  Projects    Project[]

  authorId String

  @@index([authorId])
}

model Log {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String  @db.VarChar(255)
  description String  @db.VarChar(255)
  url         String  @db.VarChar(255)
  action      String  @db.VarChar(255)
  category    String  @db.VarChar(255)
  severity    String  @db.VarChar(255)
  data        String? @db.VarChar(255)

  authorId String

  @@index([authorId])
}

model Announcement {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title       String @db.VarChar(255)
  description String @db.VarChar(255)
  reason      String @db.VarChar(255)
  url         String @db.VarChar(255)
  status      String @db.VarChar(255)

  authorId String

  @@index([authorId])
}

model Note {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String @db.VarChar(255)
  description String @db.VarChar(255)

  data String @db.Text

  blueprint Blueprint? @relation(fields: [blueprintId], references: [id])

  authorId    String
  blueprintId String?

  @@index([authorId])
  @@index([blueprintId])
}

model ExportLink {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title       String @db.VarChar(255)
  description String @db.VarChar(255)
  link        String @db.VarChar(255)

  authorId String

  @@index([authorId])
}

model MaterialType {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String @db.VarChar(255)
  description String @db.VarChar(255)

  authorId      String
  ScopeOfWork   ScopeOfWork? @relation(fields: [scopeOfWorkId], references: [id])
  scopeOfWorkId String?

  @@index([authorId])
  @@index([scopeOfWorkId])
}

model Permissions {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String @db.VarChar(255)
  description String @db.VarChar(255)
  keywords    PermissionKey[]

  authorId   String
  users      User[]
  blueprints Blueprint[]

  @@index([authorId])
}

model PermissionKey {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String @db.VarChar(255)
  description String @db.VarChar(255)
  color       String @db.VarChar(255)
  Permissions Permissions[]

  authorId String

  @@index([authorId])
}

model User {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  permissionsId String

  clerkId     String        @unique @db.VarChar(255)
  permissions Permissions   @relation(fields: [permissionsId], references: [id])
  role        String        @db.VarChar(255)

  authorId String

  @@index([authorId])
  @@index([permissionsId])
}

model Tag {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name            String @db.VarChar(255)
  description     String @db.VarChar(255)
  backgroundColor String @db.VarChar(255)
  type            String @db.VarChar(255) //crews, projects, or blueprints?

  authorId String

  CrewMembers CrewMember[]
  projects    Project[]
  blueprints  Blueprint[]

  @@index([authorId])
}
